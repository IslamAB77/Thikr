<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ThikrIslam</title>
  <link rel="icon" href="ChatGPT Image 14. Mai 2025, 01_29_57.png" type="image/png" />
  <link rel="manifest" href="/manifest.json" />
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('SW registered:', reg.scope))
        .catch(err => console.log('SW failed:', err));
    }
  </script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overscroll-behavior: none;
      touch-action: manipulation;
    }

    body {
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
      align-items: center;
      background: linear-gradient(to bottom, #064e3b, #a7f3d0);
      font-family: Consolas, monospace;
      user-select: none;
      overflow: hidden; /* Verhindert das Scrollen der gesamten Seite */
    }

    .bismillah {
      font-size: 3rem;
      color: #fff;
      text-align: center;
      margin-top: -1rem; /* Etwas nach oben */
    }
    
    .mode-display {
      font-size: 1.5rem;
      color: #fff;
      font-family: Consolas, monospace;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* NEU: Zeigt den Namen des Dhikr (kleiner) */
    .dhikr-name {
      font-size: 1.2rem; /* Kleiner als der Text */
      color: #fff;
      text-align: center;
      opacity: 0.8;
      font-weight: bold;
    }
    
    /* NEU: Haupt-Container für den arabischen Wortlaut */
    .dhikr-text {
      font-size: 2rem; /* Große, lesbare Schrift */
      color: #fff;
      text-align: center;
      line-height: 1.7; /* Zeilenabstand für Arabisch */
      width: 90%; /* Begrenzte Breite */
      max-height: 40vh; /* Maximale Höhe, z.B. 40% der Bildschirmhöhe */
      overflow-y: auto; /* **WICHTIG: Scrollbar, falls Text zu lang** */
      padding: 0 0.5rem; /* Etwas Innenabstand */
      /* Versteckt Scrollbar auf Webkit (Chrome/Safari) */
      -ms-overflow-style: none;  /* IE und Edge */
      scrollbar-width: none;  /* Firefox */
    }
    .dhikr-text::-webkit-scrollbar {
      display: none; /* Chrome, Safari und Opera */
    }


    .counter {
      font-size: 3rem; /* Zählergröße angepasst */
      color: #fff;
    }

    .progress-bar {
      width: 80%;
      height: 1rem;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 1rem;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #fff;
      width: 0%;
      transition: width 0.3s ease;
    }

    .reset-btn {
      background: rgba(255, 255, 255, 0.4);
      color: #fff;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 1rem;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(4px);
      margin-bottom: -1rem; /* Etwas nach unten */
    }

    .reset-btn:active {
      background: rgba(255, 255, 255, 0.6);
    }
  </style>
</head>
<body ontouchstart="">
  <div class="bismillah">﷽</div>
  
  <div class="mode-display" id="modeDisplay"></div>
  
  <div class="dhikr-name" id="dhikrName">Laden...</div>

  <div class="dhikr-text" id="dhikrText"></div>

  <div class="counter" id="counter">0 / 0</div>
  
  <div class="progress-bar">
    <div class="progress-fill" id="progress"></div>
  </div>
  
  <button class="reset-btn" onclick="resetCounter()">Refresh</button>

  <script>
    // --- START: Aktualisiertes JavaScript (Mit Wortlaut) ---

    let lastTouch = 0;
    let currentMode = 'Sabah';
    let appState = {};

    // 1. DEFINITION DER ATHKĀR-LISTEN (MIT WORTLAUT)
    
    // Konstanten für wiederkehrende Texte
    const TEXT_IKHLAS = "قُلْ هُوَ اللَّهُ أَحَدٌ ﴿١﴾ اللَّهُ الصَّمَدُ ﴿٢﴾ لَمْ يَلِدْ وَلَمْ يُولَدْ ﴿٣﴾ وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ ﴿٤﴾";
    const TEXT_FALAQ = "قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ ﴿١﴾ مِن شَرِّ مَا خَلَقَ ﴿٢﴾ وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ ﴿٣﴾ وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ ﴿٤﴾ وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ ﴿٥﴾";
    const TEXT_NAS = "قُلْ أَعُوذُ بِرَبِّ النَّاسِ ﴿١﴾ مَلِكِ النَّاسِ ﴿٢﴾ إِلَـٰهِ النَّاسِ ﴿٣﴾ مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ ﴿٤﴾ الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ ﴿٥﴾ مِنَ الْجِنَّةِ وَالنَّاسِ ﴿٦﴾";
    const TEXT_AYAT_KURSI = "اللَّهُ لاَ إِلَـهَ إِلاَّ هُوَ الْحَيُّ الْقَيُّومُ لاَ تَأْخُذُهُ سِنَةٌ وَلاَ نَوْمٌ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الأَرْضِ مَن ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلاَّ بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْfهُمْ وَلاَ يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلاَّ بِمَا شَاء وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالأَرْضَ وَلاَ يَؤُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ";
    const TEXT_SAYYID_ISTIGHFAR = "اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ، خَلَقْتَنِي وَأَنَا عَبْدُكَ، وَأَنَا عَلَى عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ، أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ، أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ، وَأَبُوءُ بِذَنْبِي فَاغْفِرْ لِي فَإِنَّهُ لاَ يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ";
    const TEXT_ASKALUKA_AFWA = "اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي الدُّنْيَا وَالآخِرَةِ، اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي دِينِي وَدُنْيَايَ وَأَهْلِي وَمَالِي، اللَّهُمَّ اسْتُرْ عَوْرَاتِي وَآمِنْ رَوْعَاتِي، اللَّهُمَّ احْfظْنِي مِنْ بَيْنِ يَدَيَّ وَمِنْ خَلْfِي وَعَنْ يَمِينِي وَعَنْ شِمَالِي وَمِنْ فَوْقِي، وَأَعُوذُ بِعَظَمَتِكَ أَنْ أُغْتَالَ مِنْ تَحْتِي";
    const TEXT_BISMILLAHILLADHI = "بِسْمِ اللَّهِ الَّذِي لاَ يَضُرُّ مَعَ اسْمِهِ شَيْءٌ فِي الأَرْضِ وَلاَ فِي السَّمَاءِ وَهُوَ السَّمِيعُ الْعَلِيمُ";
    const TEXT_RADITU_BILLAHI = "رَضِيتُ بِاللَّهِ رَبًّا، وَبِالإِسْلاَمِ دِينًا، وَبِمُحَمَّدٍ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ نَبِيًّا";
    const TEXT_SUBHANALLAHI = "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ";
    const TEXT_LA_ILAHA = "لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ، وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ";

    const SABAH_LIST_TEMPLATE = [
      { name: "Āyat al-Kursī", target: 1, text: TEXT_AYAT_KURSI },
      { name: "Sūrat al-Ikhlāṣ", target: 3, text: TEXT_IKHLAS },
      { name: "Sūrat al-Falaq", target: 3, text: TEXT_FALAQ },
      { name: "Sūrat an-Nās", target: 3, text: TEXT_NAS },
      { name: "Sayyid al-Istighfār", target: 1, text: TEXT_SAYYID_ISTIGHFAR },
      { name: "Allāhumma bika aṣbaḥnā", target: 1, text: "اللَّهُمَّ بِكَ أَصْبَحْنَا، وَبِكَ أَمْسَيْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ النُّشُورُ" },
      { name: "Allāhumma innī as'aluka...", target: 1, text: TEXT_ASKALUKA_AFWA },
      { name: "Bismillāhilladhī lā yaḍurru...", target: 3, text: TEXT_BISMILLAHILLADHI },
      { name: "Raḍītu billāhi Rabbā...", target: 3, text: TEXT_RADITU_BILLAHI },
      { name: "SubḥānAllāhi wa biḥamdihi", target: 100, text: TEXT_SUBHANALLAHI },
      { name: "Lā ilāha illAllāh waḥdahū...", target: 100, text: TEXT_LA_ILAHA }
    ];

    const MASA_LIST_TEMPLATE = [
      { name: "Āyat al-Kursī", target: 1, text: TEXT_AYAT_KURSI },
      { name: "Sūrat al-Ikhlāṣ", target: 3, text: TEXT_IKHLAS },
      { name: "Sūrat al-Falaq", target: 3, text: TEXT_FALAQ },
      { name: "Sūrat an-Nās", target: 3, text: TEXT_NAS },
      { name: "Sayyid al-Istighfār", target: 1, text: TEXT_SAYYID_ISTIGHFAR },
      { name: "Allāhumma bika amsaynā", target: 1, text: "اللَّهُمَّ بِكَ أَمْسَيْنَا، وَبِكَ أَصْبَحْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ الْمَصِيرُ" },
      { name: "Allāhumma innī as'aluka...", target: 1, text: TEXT_ASKALUKA_AFWA },
      { name: "Bismillāhilladhī lā yaḍurru...", target: 3, text: TEXT_BISMILLAHILLADHI },
      { name: "Raḍītu billāhi Rabbā...", target: 3, text: TEXT_RADITU_BILLAHI },
      { name: "SubḥānAllāhi wa biḥamdihi", target: 100, text: TEXT_SUBHANALLAHI },
      { name: "Lā ilāha illAllāh waḥdahū...", target: 100, text: TEXT_LA_ILAHA }
    ];

    // (Hilfsfunktion) Erstellt eine frische Liste aus der Vorlage
    function createListFromTemplate(template) {
      const newList = JSON.parse(JSON.stringify(template));
      newList.forEach(item => item.current = 0);
      return newList;
    }

    // 2. STATE MANAGEMENT (Laden, Speichern, Zurücksetzen)

    function loadState() {
      const storedState = localStorage.getItem('athkarAppState');
      if (storedState) {
        appState = JSON.parse(storedState);
        // Sicherstellen, dass die geladenen Listen mit der Vorlage übereinstimmen (falls Code aktualisiert wurde)
        if (appState.Sabah.list.length !== SABAH_LIST_TEMPLATE.length) {
          console.log("Sabah-Liste veraltet. Wird zurückgesetzt.");
          resetMode('Sabah');
        }
        if (appState.Masa.list.length !== MASA_LIST_TEMPLATE.length) {
          console.log("Masa-Liste veraltet. Wird zurückgesetzt.");
          resetMode('Masa');
        }
      } else {
        // Erstellt einen brandneuen Zustand
        appState = {
          Sabah: { currentIndex: 0, list: createListFromTemplate(SABAH_LIST_TEMPLATE) },
          Masa: { currentIndex: 0, list: createListFromTemplate(MASA_LIST_TEMPLATE) }
        };
        saveState();
      }
    }

    function saveState() {
      localStorage.setItem('athkarAppState', JSON.stringify(appState));
    }

    // (Hilfsfunktion) Setzt nur einen bestimmten Modus zurück
    function resetMode(mode) {
        const template = (mode === 'Sabah') ? SABAH_LIST_TEMPLATE : MASA_LIST_TEMPLATE;
        appState[mode].list = createListFromTemplate(template);
        appState[mode].currentIndex = 0;
    }
    
    // Setzt den Zähler für den *aktuellen* Modus zurück
    function resetCounter() {
      determineMode();
      resetMode(currentMode);
      saveState();
      updateDisplay();
    }

    // 3. KERNLOGIK (Modus bestimmen, UI aktualisieren)

    function determineMode() {
      const currentHour = new Date().getHours(); // 0-23
      currentMode = (currentHour < 12) ? 'Sabah' : 'Masa'; // 00:00-11:59 = Sabah
      document.getElementById('modeDisplay').textContent = `Athkār al-${currentMode}`;
    }

    function updateDisplay() {
      determineMode();
      
      const modeState = appState[currentMode];
      const index = modeState.currentIndex;
      const list = modeState.list;
      const dhikrTextEl = document.getElementById('dhikrText');

      if (index >= list.length) {
        // Alle Athkār für diesen Modus sind abgeschlossen
        document.getElementById('dhikrName').textContent = "Abgeschlossen";
        document.getElementById('counter').textContent = "Mā šāʾ Allāh";
        dhikrTextEl.textContent = "تقبل الله"; // "Taqabbal Allāh"
        document.getElementById('progress').style.width = '100%';
      } else {
        // Zeigt das aktuelle Dhikr an
        const activeDhikr = list[index];
        document.getElementById('dhikrName').textContent = activeDhikr.name;
        document.getElementById('counter').textContent = `${activeDhikr.current} / ${activeDhikr.target}`;
        
        // **NEU: Setzt den arabischen Wortlaut**
        dhikrTextEl.textContent = activeDhikr.text;
        // Scrollt das Textfeld bei jedem Update nach oben
        dhikrTextEl.scrollTop = 0; 

        const prozent = Math.round((index / list.length) * 100);
        document.getElementById('progress').style.width = prozent + '%';
      }
    }

    // 4. EVENT LISTENER (Handling des Klicks/Taps)

    document.body.addEventListener('touchstart', e => {
      const now = Date.now();
      if (now - lastTouch <= 100) return; 
      lastTouch = now;

      determineMode(); 
      
      const modeState = appState[currentMode];
      const index = modeState.currentIndex;
      const list = modeState.list;

      if (index >= list.length) {
        if (navigator.vibrate) navigator.vibrate(50);
        return;
      }

      const activeDhikr = list[index];
      activeDhikr.current++;

      if (activeDhikr.current >= activeDhikr.target) {
        modeState.currentIndex++;
      }

      saveState();
      updateDisplay();
      if (navigator.vibrate) navigator.vibrate(50);
    });

    // Initialer Ladevorgang
    loadState();
    updateDisplay();

    // --- ENDE: Aktualisiertes JavaScript ---
  </script>
</body>
</html>
